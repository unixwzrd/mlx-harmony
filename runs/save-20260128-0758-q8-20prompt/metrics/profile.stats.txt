Wed Jan 28 08:05:35 2026    stats/profile.stats

         24485688 function calls (24310945 primitive calls) in 438.165 seconds

   Ordered by: cumulative time
   List reduced from 2651 to 50 due to restriction <50>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.001    0.001  438.171  438.171 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat.py:75(main)
       20    0.001    0.000  243.141   12.157 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_turn.py:17(run_chat_turn)
       20    0.001    0.000  242.310   12.115 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_attempt.py:15(run_generation_attempt)
       20    0.000    0.000  241.561   12.078 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_adapters.py:52(stream)
       20    0.074    0.004  241.561   12.078 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_generation.py:10(stream_generation)
     9291    0.061    0.000  241.476    0.026 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generator.py:183(generate)
     9311  192.283    0.021  241.399    0.026 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generate_standalone.py:201(stream_generate)
        1    0.000    0.000  194.967  194.967 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_bootstrap.py:47(bootstrap_chat)
        1    0.000    0.000  194.965  194.965 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generator.py:30(__init__)
        1  193.671  193.671  194.546  194.546 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/loader.py:211(load_model_standalone)
       20   22.035    1.102   22.083    1.104 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generate_standalone.py:81(_prefill_kv_cache)
     9311    0.039    0.000   20.065    0.002 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:242(__call__)
     9311    0.243    0.000   19.995    0.002 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:208(__call__)
   223464    0.786    0.000   19.526    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:178(__call__)
   223464    2.107    0.000   10.532    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:114(__call__)
   223464    0.934    0.000    7.476    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:156(__call__)
     9291    6.986    0.001    6.996    0.001 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/sampling.py:288(processor)
   223464    0.910    0.000    5.184    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/switch_layers.py:204(__call__)
   446928    3.864    0.000    4.021    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/rope_utils.py:164(__call__)
   670392    2.859    0.000    3.312    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/switch_layers.py:91(__call__)
  1126631    2.460    0.000    2.585    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/mlx/nn/layers/quantized.py:242(__call__)
  4975042    1.040    0.000    1.627    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/mlx/nn/layers/base.py:99(__getattr__)
   111732    0.982    0.000    0.982    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/cache.py:29(update_and_fetch)
  6827083    0.771    0.000    0.771    0.000 {method 'get' of 'dict' objects}
      304    0.010    0.000    0.743    0.002 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/openai_harmony/__init__.py:540(encode)
      304    0.001    0.000    0.727    0.002 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/openai_harmony/__init__.py:67(_special_token_regex)
        1    0.167    0.167    0.713    0.713 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/tokenizer_native.py:470(load_tokenizer_native)
   223464    0.706    0.000    0.706    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:46(mlx_topk)
      122    0.000    0.000    0.651    0.005 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generator.py:520(render_prompt_tokens)
      122    0.004    0.000    0.651    0.005 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompts/harmony.py:49(render_prompt_tokens)
   111732    0.059    0.000    0.644    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/cache.py:235(update_and_fetch)
698625/696212    0.177    0.000    0.631    0.000 {built-in method builtins.hasattr}
   223464    0.626    0.000    0.626    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:74(__call__)
     7322    0.031    0.000    0.602    0.000 {method 'join' of 'str' objects}
   111492    0.569    0.000    0.580    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/cache.py:193(_update_in_place)
   331482    0.046    0.000    0.571    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/openai_harmony/__init__.py:68(<genexpr>)
       20    0.000    0.000    0.560    0.028 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_prompt.py:66(truncate_conversation_for_context)
       20    0.000    0.000    0.560    0.028 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompt_cache.py:134(update_with_conversation)
   331228    0.061    0.000    0.525    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/re/__init__.py:255(escape)
   339077    0.475    0.000    0.475    0.000 {method 'translate' of 'str' objects}
       81    0.000    0.000    0.460    0.006 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompt_cache.py:47(_ensure_base_tokens)
       20    0.000    0.000    0.452    0.023 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_adapters.py:87(parse)
       20    0.002    0.000    0.451    0.023 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_harmony.py:29(parse_harmony_response)
       25    0.001    0.000    0.446    0.018 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/json/__init__.py:274(load)
   456239    0.440    0.000    0.440    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/mlx/nn/layers/normalization.py:142(__call__)
       40    0.000    0.000    0.375    0.009 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompt_cache.py:72(_message_token_ids)
    289/4    0.001    0.000    0.346    0.087 <frozen importlib._bootstrap>:1349(_find_and_load)
    286/4    0.001    0.000    0.346    0.087 <frozen importlib._bootstrap>:1304(_find_and_load_unlocked)
    270/4    0.000    0.000    0.346    0.086 <frozen importlib._bootstrap>:911(_load_unlocked)
    262/4    0.000    0.000    0.346    0.086 <frozen importlib._bootstrap_external>:993(exec_module)


