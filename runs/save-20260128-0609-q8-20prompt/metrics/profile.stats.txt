Wed Jan 28 06:16:36 2026    stats/profile.stats

         24487278 function calls (24312535 primitive calls) in 438.451 seconds

   Ordered by: cumulative time
   List reduced from 2638 to 50 due to restriction <50>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.001    0.001  438.458  438.458 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat.py:75(main)
       20    0.001    0.000  271.224   13.561 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_turn.py:17(run_chat_turn)
       20    0.001    0.000  270.352   13.518 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_attempt.py:15(run_generation_attempt)
       20    0.000    0.000  269.558   13.478 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_adapters.py:52(stream)
       20    0.084    0.004  269.558   13.478 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_generation.py:10(stream_generation)
     9291    0.077    0.000  269.461    0.029 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generator.py:182(generate)
     9311  218.080    0.023  269.368    0.029 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generate_standalone.py:199(stream_generate)
        1    0.000    0.000  167.165  167.165 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_bootstrap.py:47(bootstrap_chat)
        1    0.000    0.000  167.162  167.162 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generator.py:30(__init__)
        1  165.827  165.827  166.687  166.687 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/loader.py:211(load_model_standalone)
     9311    0.046    0.000   22.390    0.002 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:242(__call__)
     9311    0.287    0.000   22.311    0.002 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:208(__call__)
   223464    0.894    0.000   21.778    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:178(__call__)
       20   21.159    1.058   21.210    1.061 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generate_standalone.py:79(_prefill_kv_cache)
   223464    2.358    0.000   11.824    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:114(__call__)
   223464    1.041    0.000    8.267    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:156(__call__)
     9291    7.706    0.001    7.716    0.001 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/sampling.py:288(processor)
   223464    1.023    0.000    5.712    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/switch_layers.py:204(__call__)
   446928    4.382    0.000    4.563    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/rope_utils.py:164(__call__)
   670392    3.157    0.000    3.639    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/switch_layers.py:91(__call__)
  1126631    2.703    0.000    2.837    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/mlx/nn/layers/quantized.py:242(__call__)
  4975042    1.182    0.000    1.777    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/mlx/nn/layers/base.py:99(__getattr__)
   111732    1.099    0.000    1.099    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/cache.py:29(update_and_fetch)
   223464    0.799    0.000    0.799    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:46(mlx_topk)
  6827023    0.790    0.000    0.790    0.000 {method 'get' of 'dict' objects}
      304    0.011    0.000    0.775    0.003 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/openai_harmony/__init__.py:540(encode)
      304    0.001    0.000    0.758    0.002 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/openai_harmony/__init__.py:67(_special_token_regex)
   111732    0.067    0.000    0.731    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/cache.py:235(update_and_fetch)
698625/696212    0.196    0.000    0.710    0.000 {built-in method builtins.hasattr}
        1    0.159    0.159    0.702    0.702 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/tokenizer_native.py:470(load_tokenizer_native)
   223464    0.701    0.000    0.701    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:74(__call__)
      122    0.000    0.000    0.681    0.006 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generator.py:515(render_prompt_tokens)
      122    0.005    0.000    0.680    0.006 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompts/harmony.py:49(render_prompt_tokens)
   111492    0.647    0.000    0.659    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/cache.py:193(_update_in_place)
     7322    0.034    0.000    0.634    0.000 {method 'join' of 'str' objects}
   331482    0.050    0.000    0.600    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/openai_harmony/__init__.py:68(<genexpr>)
       20    0.000    0.000    0.586    0.029 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_prompt.py:66(truncate_conversation_for_context)
       20    0.000    0.000    0.586    0.029 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompt_cache.py:134(update_with_conversation)
   331228    0.065    0.000    0.550    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/re/__init__.py:255(escape)
   339077    0.498    0.000    0.498    0.000 {method 'translate' of 'str' objects}
       81    0.000    0.000    0.477    0.006 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompt_cache.py:47(_ensure_base_tokens)
   456239    0.476    0.000    0.476    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/mlx/nn/layers/normalization.py:142(__call__)
       20    0.000    0.000    0.463    0.023 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_adapters.py:87(parse)
       20    0.001    0.000    0.462    0.023 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_harmony.py:29(parse_harmony_response)
       25    0.001    0.000    0.442    0.018 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/json/__init__.py:274(load)
    289/4    0.001    0.000    0.400    0.100 <frozen importlib._bootstrap>:1349(_find_and_load)
       40    0.000    0.000    0.400    0.010 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompt_cache.py:72(_message_token_ids)
    286/4    0.002    0.000    0.400    0.100 <frozen importlib._bootstrap>:1304(_find_and_load_unlocked)
    270/4    0.001    0.000    0.400    0.100 <frozen importlib._bootstrap>:911(_load_unlocked)
    262/4    0.000    0.000    0.399    0.100 <frozen importlib._bootstrap_external>:993(exec_module)


