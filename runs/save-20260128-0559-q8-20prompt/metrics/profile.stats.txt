Wed Jan 28 06:07:24 2026    stats/profile.stats

         24487418 function calls (24312675 primitive calls) in 477.232 seconds

   Ordered by: cumulative time
   List reduced from 2638 to 50 due to restriction <50>

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
        1    0.001    0.001  477.239  477.239 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat.py:75(main)
       20    0.001    0.000  284.792   14.240 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_turn.py:17(run_chat_turn)
       20    0.002    0.000  283.775   14.189 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_attempt.py:15(run_generation_attempt)
       20    0.000    0.000  282.808   14.140 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_adapters.py:52(stream)
       20    0.090    0.005  282.808   14.140 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_generation.py:10(stream_generation)
     9291    0.077    0.000  282.703    0.030 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generator.py:182(generate)
     9311  222.183    0.024  282.609    0.030 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generate_standalone.py:199(stream_generate)
        1    0.000    0.000  192.365  192.365 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_bootstrap.py:47(bootstrap_chat)
        1    0.000    0.000  192.362  192.362 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generator.py:30(__init__)
        1  191.093  191.093  191.964  191.964 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/loader.py:211(load_model_standalone)
       20   28.454    1.423   28.511    1.426 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generate_standalone.py:79(_prefill_kv_cache)
     9311    0.046    0.000   24.634    0.003 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:242(__call__)
     9311    0.312    0.000   24.551    0.003 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:208(__call__)
   223464    0.968    0.000   23.975    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:178(__call__)
   223464    2.613    0.000   12.917    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:114(__call__)
   223464    1.155    0.000    9.195    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:156(__call__)
     9291    7.302    0.001    7.315    0.001 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/sampling.py:288(processor)
   223464    1.122    0.000    6.378    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/switch_layers.py:204(__call__)
   446928    4.690    0.000    4.881    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/rope_utils.py:164(__call__)
   670392    3.541    0.000    4.073    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/switch_layers.py:91(__call__)
  1126631    3.082    0.000    3.237    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/mlx/nn/layers/quantized.py:242(__call__)
  4975042    1.269    0.000    1.957    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/mlx/nn/layers/base.py:99(__getattr__)
   111732    1.171    0.000    1.171    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/cache.py:29(update_and_fetch)
  6827023    0.910    0.000    0.910    0.000 {method 'get' of 'dict' objects}
      304    0.013    0.000    0.887    0.003 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/openai_harmony/__init__.py:540(encode)
      304    0.001    0.000    0.866    0.003 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/openai_harmony/__init__.py:67(_special_token_regex)
   223464    0.847    0.000    0.847    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:46(mlx_topk)
   223464    0.789    0.000    0.789    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/models/gpt_oss.py:74(__call__)
   111732    0.071    0.000    0.788    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/cache.py:235(update_and_fetch)
      122    0.001    0.000    0.783    0.006 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/generator.py:515(render_prompt_tokens)
      122    0.007    0.000    0.782    0.006 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompts/harmony.py:49(render_prompt_tokens)
     7322    0.038    0.000    0.740    0.000 {method 'join' of 'str' objects}
   111492    0.698    0.000    0.710    0.000 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/cache.py:193(_update_in_place)
   331482    0.060    0.000    0.701    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/openai_harmony/__init__.py:68(<genexpr>)
        1    0.155    0.155    0.686    0.686 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/tokenizer_native.py:470(load_tokenizer_native)
698625/696212    0.214    0.000    0.682    0.000 {built-in method builtins.hasattr}
       20    0.000    0.000    0.671    0.034 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_prompt.py:66(truncate_conversation_for_context)
       20    0.000    0.000    0.671    0.034 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompt_cache.py:134(update_with_conversation)
   331228    0.074    0.000    0.641    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/re/__init__.py:255(escape)
   339077    0.583    0.000    0.583    0.000 {method 'translate' of 'str' objects}
       20    0.000    0.000    0.570    0.028 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_adapters.py:87(parse)
       20    0.002    0.000    0.570    0.028 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/chat_harmony.py:29(parse_harmony_response)
   456239    0.548    0.000    0.548    0.000 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/mlx/nn/layers/normalization.py:142(__call__)
       81    0.000    0.000    0.544    0.007 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompt_cache.py:47(_ensure_base_tokens)
       40    0.000    0.000    0.465    0.012 /Users/mps/projects/AI-PROJECTS/mlx-harmony/src/mlx_harmony/prompt_cache.py:72(_message_token_ids)
       60    0.134    0.002    0.453    0.008 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/site-packages/unicodefix/transforms.py:27(clean_text)
       25    0.001    0.000    0.432    0.017 /Users/unixwzrd/miniconda3/envs/ConnectomeAI/lib/python3.12/json/__init__.py:274(load)
    289/4    0.001    0.000    0.322    0.081 <frozen importlib._bootstrap>:1349(_find_and_load)
    286/4    0.001    0.000    0.322    0.080 <frozen importlib._bootstrap>:1304(_find_and_load_unlocked)
    270/4    0.000    0.000    0.322    0.080 <frozen importlib._bootstrap>:911(_load_unlocked)


